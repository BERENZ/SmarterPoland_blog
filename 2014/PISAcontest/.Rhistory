names(biblioL) <- gsub(substr(biblioL,2,1000), pattern="\\}.*", replacement="")
biblioL <- sub(biblioL,pattern="\\{[^\\]*\\}", replacement="")
biblioL <- gsub(biblioL, pattern="^[ \t\n]+", replacement="")
biblioL <- gsub(biblioL, pattern="[ \t\n\\.]+$", replacement="")
pre1 <- '';# '<div class="container">'
pre2 <- '<div class="row">
<div class="col-lg-3 col-md-3 col-sm-3">'
pre3 <- '</div>
<div class="col-lg-7 col-md-7 col-sm-7"><p style="font-size:large">'
pre4 <- '</p></div>
<div class="col-lg-2 col-md-2 col-sm-2">'
pre5 <- '</div>
</div><!-- /.row -->'
pre6 <- '';#'</div><!-- /.container -->'
pre23 <- '<div class="row">
<div class="col-lg-10 col-md-10 col-sm-10"><p>'
tekstWynik <- paste0(pre1, pre2, pre3, tekst, pre4, pre5, pre6)
# '' i ,,
tekstWynik <- gsub(tekstWynik, pattern=",,", replacement="&ldquo;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern="''", replacement="&rdquo;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern="\\\\", replacement="</br>", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern="\\circ", replacement="o", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern="--", replacement="&ndash;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern="\\[width=[^2][0-9\\.]+cm\\]", replacement="")
tekstWynik <- gsub(tekstWynik, pattern="[h!]", replacement="", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern="\\vspace{1cm}", replacement="", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern="\\vspace{3cm}", replacement="", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern="\\vspace{0.5cm}", replacement="", fixed=TRUE)
#
# zamien \textit{} na <i> </i>
kawalki <- strsplit(tekstWynik, split="\\textit{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0("<i>",sub(kawalki[-1], pattern="}", replacement="</i>", fixed=TRUE)), collapse=""))
}
kawalki <- strsplit(tekstWynik, split="\\textsl{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0("<i>",sub(kawalki[-1], pattern="}", replacement="</i>", fixed=TRUE)), collapse=""))
}
#
# zamien \textbf{} na <b> </b>
kawalki <- strsplit(tekstWynik, split="\\textbf{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0("<b>",sub(kawalki[-1], pattern="}", replacement="</b>", fixed=TRUE)), collapse=""))
}
#
# zamien \texttt{http} na <a> </a>
kawalki <- strsplit(tekstWynik, split="\\texttt{http://", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
linki <- paste0("http://",sub(kawalki[-1], pattern="\\}.*", replacement=""))
reszta <- sub(kawalki[-1], pattern="[^\\}]*\\}", replacement="")
tekstWynik <- paste(kawalki[1], paste(paste0('<a href="',linki, '">', linki, '</a>', reszta), collapse=""))
}
#
# zamien \texttt{https} na <a> </a>
kawalki <- strsplit(tekstWynik, split="\\texttt{https://", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
linki <- paste0("https://",sub(kawalki[-1], pattern="}.+", replacement=""))
reszta <- sub(kawalki[-1], pattern="[^\\}]*\\}", replacement="")
tekstWynik <- paste(kawalki[1], paste(paste0('<a href="',linki, '">', linki, '</a>', reszta), collapse=""))
}
kawalki <- strsplit(tekstWynik, split="\\texttt{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0("<code>",sub(kawalki[-1], pattern="}", replacement="</code>", fixed=TRUE)), collapse=""))
}
#
# zamien \\linebreak na <br/>
tekstWynik <- gsub(tekstWynik, pattern="\\linebreak", replacement="<br/>", fixed=TRUE)
#
# zamien \begin{enumerate} na <ol>
kawalki <- strsplit(tekstWynik, split="\\begin{enumerate}", fixed=TRUE)[[1]]
if (length(kawalki)>1) {
srodek <- sapply(strsplit(kawalki[-1], split="\\end{enumerate}", fixed=TRUE), '[', 1)
srodek <- sapply(strsplit(srodek, split="\\item", fixed=TRUE), function(s) {
paste(paste0("<li><p  style='font-size:large'>", s[-1], "</p></li>"), collapse="")
})
reszta <- sapply(strsplit(kawalki[-1], split="\\end{enumerate}", fixed=TRUE), '[', 2)
tekstWynik <- paste(kawalki[1], paste(paste0("</p><ol>", srodek, "</ol><p  style='font-size:large'>", reszta), collapse=""))
}
# zamien \begin{itemize} na <ul>
kawalki <- strsplit(tekstWynik, split="\\begin{itemize}", fixed=TRUE)[[1]]
if (length(kawalki)>1) {
srodek <- sapply(strsplit(kawalki[-1], split="\\end{itemize}", fixed=TRUE), '[', 1)
srodek <- sapply(strsplit(srodek, split="\\item", fixed=TRUE), function(s) {
paste(paste0("<li><p  style='font-size:large'>", s[-1], "</p></li>"), collapse="")
})
reszta <- sapply(strsplit(kawalki[-1], split="\\end{itemize}", fixed=TRUE), '[', 2)
tekstWynik <- paste(kawalki[1], paste(paste0("</p><ul>", srodek, "</ul><p  style='font-size:large'>", reszta), collapse=""))
}
#
# zamien \begin{verbatim} na <pre>
kawalki <- strsplit(tekstWynik, split="\\begin{verbatim}", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
srodek <- sapply(strsplit(kawalki[-1], split="\\end{verbatim}", fixed=TRUE), '[', 1)
reszta <- sapply(strsplit(kawalki[-1], split="\\end{verbatim}", fixed=TRUE), '[', 2)
tekstWynik <- paste(kawalki[1], paste(paste0("</p><pre>", srodek, "</pre><p  style='font-size:large'>", reszta), collapse=""))
}
#
# zamien \begin{center} na <center>
kawalki <- strsplit(tekstWynik, split="\\begin{center}", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
srodek <- sapply(strsplit(kawalki[-1], split="\\end{center}", fixed=TRUE), '[', 1)
reszta <- sapply(strsplit(kawalki[-1], split="\\end{center}", fixed=TRUE), '[', 2)
tekstWynik <- paste(kawalki[1], paste(paste0("<center>", srodek, "</center>", reszta), collapse=""))
}
#
# zamien \begin{figure*} na <img>
kawalki <- strsplit(tekstWynik, split="\\begin{figure*}", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0("<img width='100px' src='grafika/",sub(kawalki[-1], pattern="}", replacement="'/>", fixed=TRUE)), collapse=""))
srodek <- sapply(strsplit(kawalki[-1], split="\\end{figure*}", fixed=TRUE), '[', 1)
reszta <- sapply(strsplit(kawalki[-1], split="\\end{figure*}", fixed=TRUE), '[', 2)
tekstWynik <- paste(kawalki[1], paste(paste0(pre4, pre5, pre23, srodek, pre4, pre5, pre2, pre3, reszta), collapse=""))
}
#
# zamien \begin{figure} na <img>
kawalki <- strsplit(tekstWynik, split="\\begin{figure}", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
srodek <- sapply(strsplit(kawalki[-1], split="\\end{figure}", fixed=TRUE), '[', 1)
# inaczej traktuje ten caption
ssrodek <- strsplit(srodek, split="\\caption", fixed=TRUE)
srodek <- paste0("\\\\Fcaption", sapply(ssrodek, '[', 2), sapply(ssrodek, '[', 1))
reszta <- sapply(strsplit(kawalki[-1], split="\\end{figure}", fixed=TRUE), '[', 2)
tekstWynik <- paste(kawalki[1], paste(paste0("</p>", srodek, "<p  style='font-size:large'>", reszta), collapse=""))
}
#
# zamien \begin{marginfigure} na <aside>
kawalki <- strsplit(tekstWynik, split="\\begin{marginfigure}", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
srodek <- sapply(strsplit(kawalki[-1], split="\\end{marginfigure}", fixed=TRUE), '[', 1)
reszta <- sapply(strsplit(kawalki[-1], split="\\end{marginfigure}", fixed=TRUE), '[', 2)
tekstWynik <- paste(kawalki[1], paste(paste0(pre4, pre5, pre2, srodek, pre3, reszta), collapse=""))
# zamien \includegraphics
kawalki <- strsplit(tekstWynik, split="\\includegraphics{", fixed=TRUE)[[1]]
if (workingDraft) {
########### TYLKO na potrzeby wycinania obrazkow
tekstWynik <- paste(kawalki[1], paste(paste0( "<i>", sub(kawalki[-1], pattern="\\}.*", replacement=""),"</i>",
"<img width='100%' src='grafika/",sub(kawalki[-1], pattern="\\.[a-z]+\\}", replacement=".png'/>")), collapse=""))
# zamien \includegraphics[width=2cm]
} else {
tekstWynik <- paste(kawalki[1], paste(paste0(
"<img width='100%' src='grafika/",sub(kawalki[-1], pattern="\\.[a-z]+\\}", replacement=".png'/>")), collapse=""))
# zamien \includegraphics[width=2cm]
}
}
kawalki <- strsplit(tekstWynik, split="\\includegraphics[width=2cm]{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0("<img width='100px' src='grafika/",sub(kawalki[-1], pattern="}", replacement="'/>", fixed=TRUE)), collapse=""))
}
# zamien \\label
kawalki <- strsplit(tekstWynik, split="\\label{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0("",sub(kawalki[-1], pattern="[^\\}]*\\}", replacement="")), collapse=""))
}
# zamien \\caption
kawalki <- strsplit(tekstWynik, split="\\caption{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0("Rysunek ___: ",sub(kawalki[-1], pattern="}", replacement="", fixed=TRUE)), collapse=""))
}
kawalki <- strsplit(tekstWynik, split="\\Fcaption{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0(pre4, pre5, pre2, "&nbsp;<br/>Rysunek ___: ", sub(kawalki[-1], pattern="}", replacement=pre3, fixed=TRUE)), collapse=""))
}
#
# zamien \subsection{} na <h3> </h3>
kawalki <- strsplit(tekstWynik, split="\\subsection{", fixed=TRUE)[[1]]
#tekstWynik <- paste(kawalki[1], paste(paste0("</p>\n<h2>",sub(kawalki[-1], pattern="}", replacement="</h2>\n<p style='font-size:large'>", fixed=TRUE)), collapse=""))
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0(pre4, pre5, pre23, "<h2>", sub(kawalki[-1], pattern="}", replacement=paste0("</h2>",pre4,pre5,pre2,pre3), fixed=TRUE)), collapse=""))
}
kawalki <- strsplit(tekstWynik, split="\\section*{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0(pre4, pre5, pre23, "<h2>", sub(kawalki[-1], pattern="}", replacement=paste0("</h2>",pre4,pre5,pre2,pre3), fixed=TRUE)), collapse=""))
}
kawalki <- strsplit(tekstWynik, split="\\subsection*{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0(pre4, pre5, pre23, "<h2>", sub(kawalki[-1], pattern="}", replacement=paste0("</h2>",pre4,pre5,pre2,pre3), fixed=TRUE)), collapse=""))
}
#
# zamien \n\n na <p>
tekstWynik <- gsub(tekstWynik, pattern="\n\n", replacement="</p>\n\n<p style='font-size:large'>")
tekstWynik <- gsub(tekstWynik, pattern="\\clearpage", replacement="\n\n")
#
# zamien \cite na aside
kawalki <- strsplit(tekstWynik, split="\\cite{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
literatura <- biblioL[gsub(kawalki[-1], pattern="\\}.*", replacement="")]
#tekstWynik <- paste(kawalki[1], paste(paste0(pre4, pre5, pre2,"(",literatura,")",  "Cite: ", sub(kawalki[-1], pattern="}", replacement=pre3, fixed=TRUE)), collapse=""))
tekstWynik <- paste(kawalki[1], paste(paste0("<small><b>[",literatura, sub(kawalki[-1], pattern="[^\\}]*\\}", replacement="]</b></small>")), collapse=""))
}
#
# zamien \footnote na aside
kawalki <- strsplit(tekstWynik, split="\\footnote{", fixed=TRUE)[[1]]
if (length(kawalki) > 1) {
tekstWynik <- paste(kawalki[1], paste(paste0(pre4, pre5, pre2, sub(kawalki[-1], pattern="}", replacement=pre3, fixed=TRUE)), collapse=""))
tekstWynik <- gsub(tekstWynik, pattern=">.", replacement=">", fixed=TRUE)
}
#
# usuwamy sieroty
tekstWynik <- gsub(tekstWynik, pattern=" w ", replacement=" w&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" i ", replacement=" i&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" a ", replacement=" a&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" z ", replacement=" z&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" o ", replacement=" o&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" W ", replacement=" W&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" I ", replacement=" I&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" A ", replacement=" A&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" Z ", replacement=" Z&nbsp;", fixed=TRUE)
tekstWynik <- gsub(tekstWynik, pattern=" O ", replacement=" O&nbsp;", fixed=TRUE)
tekstWynikL <- strsplit(tekstWynik, split="Rysunek ___: ")[[1]]
tekstWynik <- paste0(tekstWynikL[1], paste(paste0("Rysunek ", seq_along(tekstWynikL[-1]), ": ", tekstWynikL[-1]), collapse=""))
splitter = '</div><!-- /.row --><div class="row">'
splitter2 = '<div class="col-lg-..? col-md-..? col-sm-..?">'
tekstWynik <- paste(sapply(strsplit(tekstWynik, split=splitter)[[1]], function(x) {
nx <- strsplit(x, split=splitter2)[[1]]
if (length(nx) == 4) {
x <- paste0(nx[1],
'<div class="col-lg-2 col-md-2 col-sm-2">', nx[4],
'<div class="col-lg-7 col-md-7 col-sm-7">', nx[3],
'<div class="col-lg-3 col-md-3 col-sm-3">', nx[2])
}
if (length(nx) == 3) {
x <- paste0(nx[1],
'<div class="col-lg-2 col-md-2 col-sm-2">', nx[3],
'<div class="col-lg-10 col-md-7 col-sm-10">', nx[2])
}
x
}), collapse=splitter)
tekstWynik <- gsub(tekstWynik, pattern='<div class="col-lg-2 col-md-2 col-sm-2"></div>
<div class="col-lg-10 col-md-7 col-sm-10"><p><h2>',
replacement='<div class="col-lg-1 col-md-1 col-sm-1"></div>
<div class="col-lg-10 col-md-7 col-sm-10"><p><h2>')
wynik <- gsub(szablon, pattern="---HERE---", replacement=tekstWynik)
writeLines(text=wynik, con=plik3, useBytes=TRUE)
setwd("C:/_Przemek_/GitHub/SmarterPoland_blog/2014/PISAcontest")
con <- url("http://beta.icm.edu.pl/PISAcontest/data/student2012.rda")
load(con)
library(intsvy)
library(devtools)
install_github("intsvy", "pbiecek")
library(intsvy)
colnames(student2012)[1:10]
pisa.table(variable="ST87Q07", by="CNT", data=student2012)
tab <- pisa.table(variable="ST87Q07", by="CNT", data=student2012)
head(tab)
library(reshape2)
acast(tab, CNT~ST87Q07, value.var=Freq)
acast(tab, CNT~ST87Q07, value.var="Freq")
acast(tab, CNT~ST87Q07, value.var="Percentage")
rowSums(acast(tab, CNT~ST87Q07, value.var="Percentage"))
library(likert)
ptab <- acast(tab, CNT~ST87Q07, value.var="Percentage")
ptab
ddat <- data.frame(Item=rownames(ptab), ptab)
plot(likert(summary=ddat))
/likert
?likert
plot(likert(summary=ddat), center=2.5) +
ggtitle("Sense of Belonging - Feel Happy at School")
traceback()
plot(likert(summary=ddat, center=2.5)) +
ggtitle("Sense of Belonging - Feel Happy at School")
likert(summary=ddat)
str(likert(summary=ddat))
likert.bar.plot(likert(summary=ddat), center=2.5)
traceback()
summary.likert
likert:::summary.likert
a <- likert:::summary.likert
fix(a)
5%%1
3%%1
4%%1
likert.bar.plot(likert(summary=ddat), center=-1)
-1%%1
0%%1
NA0%%1
NA%%1
likert.bar.plot(likert(summary=ddat), center=NA)
1%%0.5
1.%%0.5
1.5%%0.5
1.25%%0.5
2.5%%1
likert.bar.plot(likert(summary=ddat), center=2.5)
options(error=recover)
likert.bar.plot(likert(summary=ddat), center=2.5)
neutral
neutral
likert.bar.plot(likert(summary=ddat), neutral=NA)
ptab
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,1:2], NA, ptab[,3:4]))
likert.bar.plot(likert(summary=ddat))
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,1:2], NA, ptab[,3:4]))
l
ddat
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,1:2], 0, ptab[,3:4]))
likert.bar.plot(likert(summary=ddat))
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Sense of Belonging - Feel Happy at School")
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Sense of Belonging - Feel Happy at School") + theme_bw()
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Sense of Belonging - Feel Happy at School")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Sense of Belonging - Feel Happy at School")
plot1 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Sense of Belonging - Feel Happy at School")
tab <- pisa.table(variable="ST87Q03", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST87Q03, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Attitude towards School - Waste of Time")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Sense of Belonging - Belong at School")
plot2
tab <- pisa.table(variable="ST88Q02", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST88Q02, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
plot3 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Attitude towards School - Waste of Time")
plot3
tab <- pisa.table(variable="ST93Q06", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST93Q06, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Perseverance - Continue to perfection")
ddat <- data.frame(Item=rownames(ptab), ptab)
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Perseverance - Continue to perfection")
tab <- pisa.table(variable="ST86Q03", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST86Q03, value.var="Percentage")
ptab
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Student-Teacher Relations - Teachers Listen to Students")
tab <- pisa.table(variable="ST86Q02", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST86Q02, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Student-Teacher Relations - Teachers Are Interested")
tab <- pisa.table(variable="ST85Q01", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST85Q01, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Classroom Management - Students Listen")
table(student2012$CNT, student2012$ST85Q01)
prop.table(table(student2012$CNT, student2012$ST85Q01),1)
round(100*prop.table(table(student2012$CNT, student2012$ST85Q01),1),1)
a <- round(100*prop.table(table(student2012$CNT, student2012$ST85Q01),1),1)
a[order(a[,4]),]
a <- round(100*prop.table(table(student2012$CNT, student2012$ST85Q01),1),1)
a[order(a[,4]+a[,3]),]
ddat
ddat["Poland",]
a[order(a[,4]+a[,3]),]
ddat["Poland",]
a <- round(100*prop.table(unclass(by(student2012$W_FSTUWT, list(student2012$CNT, student2012$ST85Q01), sum),1),1)
a[order(a[,4]+a[,3]),]
unclass(by(student2012$W_FSTUWT, list(student2012$CNT, student2012$ST85Q01), sum),1)
unclass(by(student2012$W_FSTUWT, list(student2012$CNT, student2012$ST85Q01), sum))
a <- round(100*prop.table(unclass(by(student2012$W_FSTUWT, list(student2012$CNT, student2012$ST85Q01), sum)),1),1)
a[order(a[,4]+a[,3]),]
ddat["Poland",]
ddat
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
ddat <- ddat[-grep(rownames(ddat), pattern="(", fixed=TRUE),]
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Classroom Management - Students Listen")
ddat
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Classroom Management - Students Listen")
ddat <- ddat[-grep(rownames(ddat), pattern="(", fixed=TRUE),]
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Classroom Management - Students Listen")
ddat
plot2
tab <- pisa.table(variable="ST88Q02", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST88Q02, value.var="Percentage")
ptab
tab <- pisa.table(variable="ST62Q13", by=c("CNT", "ST04Q01"), data=student2012)
tab
tab <- pisa.table(variable="ST62Q13", by="ST04Q01", data=student2012)
ptab <- acast(tab, ST04Q01~ST62Q13, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
ddat <- ddat[-grep(rownames(ddat), pattern="(", fixed=TRUE),]
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Classroom Management - Students Listen")
plot2
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
ptab
ddat <- data.frame(Item=rownames(ptab), ptab)
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction")
plot2
tab <- pisa.table(variable="ST62Q11", by="ST04Q01", data=student2012)
ptab <- acast(tab, ST04Q01~ST62Q11, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), ptab)
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction")
plot2
gc()
tab <- pisa.table(variable="ST62Q13", by="ST04Q01", data=student2012)
ptab <- acast(tab, ST04Q01~ST62Q13, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), ptab)
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction")
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
plot2
#
# variable ST87Q07 codes 'Sense of Belonging - Feel Happy at School'
# pisa.table calculates weighted fractions and it's standard errors
tab <- pisa.table(variable="ST87Q07", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST87Q07, value.var="Percentage")
# remove single states and plot it
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
plot1 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Sense of Belonging - Feel Happy at School")
#
# variable ST62Q13 codes familiarity with 'Declarative Fraction'
tab <- pisa.table(variable="ST62Q13", by="ST04Q01", data=student2012)
ptab <- acast(tab, ST04Q01~ST62Q13, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), ptab)
plot2 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
#
# variable ST88Q02 codes 'Attitude towards School - Waste of Time'
tab <- pisa.table(variable="ST88Q02", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST88Q02, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
plot3 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Attitude towards School - Waste of Time")
ggsave(plot1, filename="feelHappy.png", width=800, height=1000)
?ggsave
ggsave(plot1, filename="feelHappy.png", width=8, height=10)
ggsave(plot2, filename="DeclarativeFraction.png", width=8, height=4)
ggsave(plot3, filename="WasteofTime.png", width=8, height=10)
ggsave(plot2, filename="DeclarativeFraction.png", width=8, height=3)
ggsave(plot2, filename="DeclarativeFraction.png", width=8, height=2)
tab <- pisa.table(variable="ST62Q13", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST62Q13, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), ptab)
plot4 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
tab <- pisa.table(variable="ST87Q07", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST87Q07, value.var="Percentage")
# remove single states and plot it
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
ddat <- ddat[-grep(rownames(ddat),pattern="(", fixed=TRUE),]
plot1 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Sense of Belonging - Feel Happy at School")
tab <- pisa.table(variable="ST62Q13", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST62Q13, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), ptab)
ddat <- ddat[-grep(rownames(ddat),pattern="(", fixed=TRUE),]
plot4 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
ddat
ddat <- data.frame(Item=rownames(ptab), ptab)
ddat
ptab
ddat <- data.frame(Item=rownames(ptab), ptab[,1:5])
ddat <- ddat[-grep(rownames(ddat),pattern="(", fixed=TRUE),]
plot4 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
ddat
ddat <- na.rm(data.frame(Item=rownames(ptab), ptab[,1:5]))
ddat <- ddat[-grep(rownames(ddat),pattern="(", fixed=TRUE),]
plot4 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
ddat <- na.onit(data.frame(Item=rownames(ptab), ptab[,1:5]))
ddat <- na.omit(data.frame(Item=rownames(ptab), ptab[,1:5]))
ddat <- ddat[-grep(rownames(ddat),pattern="(", fixed=TRUE),]
plot4 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
plot4
tab <- pisa.table(variable="ST88Q02", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST88Q02, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), cbind(ptab[,4:3], 0, ptab[,2:1]))
ddat <- ddat[-grep(rownames(ddat),pattern="(", fixed=TRUE),]
plot3 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Attitude towards School - Waste of Time")
ggsave(plot1, filename="feelHappy.png", width=8, height=10)
ggsave(plot2, filename="DeclarativeFraction.png", width=8, height=2)
ggsave(plot3, filename="WasteofTime.png", width=8, height=10)
ggsave(plot4, filename="DeclarativeFraction2.png", width=8, height=10)
tab <- pisa.table(variable="ST62Q13", by="CNT", data=student2012)
ptab <- acast(tab, CNT~ST62Q13, value.var="Percentage")
ddat <- na.omit(data.frame(Item=rownames(ptab), ptab[,1:5]))
ddat <- ddat[-grep(rownames(ddat),pattern="(", fixed=TRUE),]
plot4 <- likert.bar.plot(likert(summary=ddat),  plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction")
ggsave(plot4, filename="DeclarativeFraction2.png", width=8, height=10)
likert.bar.plot(likert(summary=ddat), center=1.5, plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
tab <- pisa.table(variable="ST62Q13", by="ST04Q01", data=student2012)
ptab <- acast(tab, ST04Q01~ST62Q13, value.var="Percentage")
ddat <- data.frame(Item=rownames(ptab), ptab)
likert.bar.plot(likert(summary=ddat), center=1.5, plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
likert.bar.plot(likert(summary=ddat), plot.percent.neutral=FALSE) +
ggtitle("Declarative Fraction") + theme_bw()
likert.bar.plot(likert(summary=ddat), center=1.5)
likert.bar.plot(likert(summary=ddat), center=1)
likert.bar.plot(likert(summary=ddat), center=2)
plot2 <- likert.bar.plot(likert(summary=ddat), center=2) +
ggtitle("Declarative Fraction") + theme_bw()
plot2
ggsave(plot2, filename="DeclarativeFraction.png", width=8, height=2)
